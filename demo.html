<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Socket IO</title>

    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import { io } from "https://cdn.socket.io/4.4.1/socket.io.esm.min.js";
      const socket = io("http://127.0.0.1:8080/", { transport: ["websocket"] });

      var lockTimer = null;

      // Define the functions outside of the click event listeners
      function authenticate() {
        var token = `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7InVzZXJ_faWQiOjM2LCJyb2xlIjoidXNlciJ9LCJleHAiOjE2OTgzOTYzNDcsImlhdCI6MTY5Nzc5MTU0N30.VoVu93cDyHxUEg9lXvQCZi6EB_tM78EkL2dnrO323j4`;
        socket.emit("authenticate", token);
      }

      function test() {
        socket.emit("test", "Test message from the client");
      }

      function sendNotice() {
        var name = "Hai";
        var age = 38;
        var person = { name: name, age: age };
        socket.emit("notice", person);
      }

      socket.on("connect", function () {
        console.log("Connected to server");
      });

      authenticate();
      test();
      sendNotice();

      socket.on("your profile", function (user) {
        console.log("Received user profile:", user);
      });

      socket.on("notice", function (data) {
        console.log("Received notice:", data);
      });

      socket.on("authentication failed", function (data) {
        console.log("Received notice:", data);
      });

      socket.on("authenticate", () => {
        if (lockTimer) {
          clearInterval(lockTimer);
        }

        lockTimer = setInterval(() => {
          socket.emit("location", { lat: 10.23132, lng: 106.1231341 });
        }, 3000);
      });

      console.log("Connection established");
    </script>
  </head>
  <body>
    <h1>Socket.IO Example</h1>
  </body>
</html>
